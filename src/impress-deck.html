<polymer-element name="impress-deck" attributes="curSlide" constructor="ImpressDeck" on-mouseover="{{toggleKeyControls}}" on-mouseout="{{toggleKeyControls}}">
	<template>
		<style type="text/css">
			:host {
			  display: block;
			  overflow: hidden;
			  -webkit-transform: translate3d(0, 0, 0);
			  -moz-transform: translate3d(0, 0, 0);
			  -ms-transform: translate3d(0, 0, 0);
			  -o-transform: translate3d(0, 0, 0);
			  transform: translate3d(0, 0, 0);
			  -webkit-perspective: 1000;
			  -moz-perspective: 1000;
			  -ms-perspective: 1000;
			  -o-perspective: 1000;
			  perspective: 1000;
			  -webkit-transform-style: preserve-3d;
			  -moz-transform-style: preserve-3d;
			  -ms-transform-style: preserve-3d;
			  -o-transform-style: preserve-3d;
			  transform-style: preserve-3d;
			  -webkit-transition: opacity 800ms ease-in;
			  -webkit-transition-delay: 100ms;
			  -moz-transition: opacity 800ms ease-in 100ms;
			  -o-transition: opacity 800ms ease-in 100ms;
			  transition: opacity 800ms ease-in 100ms;
			}
		</style>
		<content id="slides" select="impress-slide"></content>
	</template>
	<script>
		(function() {
			var SLIDE_CLASSES_ 	= ['far-past', 'past', 'current', 'next', 'far-next'],
					prevSlide_ 			= 0,
					onKeyDown_			= function(e) {
					  if (/^(input|textarea)$/i.test(e.target.nodeName) ||
					      e.target.isContentEditable || !this.controlsActive) {
					    return;
					  }

						switch (e.keyCode) {
					    case 39: // right arrow
					    case 32: // space
					    case 34: // PgDn
					    case 40: // down arrow
					      this.nextSlide();
					      e.preventDefault();
					      break;

					    case 37: // left arrow
					    case 33: // PgUp
					    case 38: // up arrow
					      this.prevSlide();
					      e.preventDefault();
					      break;
					  }
				},
				addEventListeners_ = function() {
					document.addEventListener('keydown', onKeyDown_.bind(this), false);
				},
				// TODO:
				// trigger slide events
				// enable iframe preloading
				// add support for overview mode
				updateSlides_ 		= function() {
					var curSlide 					= this.curSlide,
							updateSlideClass	= updateSlideClass_.bind(this);
					for (var i = 0; i < this.totalSlides; ++i) {
						switch(i) {
							case curSlide - 2:
								updateSlideClass(i, 'far-past');
								break;
							case curSlide - 1:
								updateSlideClass(i, 'past');
								break;
				      case curSlide:
				        updateSlideClass(i, 'current');
				        break;
				      case curSlide + 1:
				        updateSlideClass(i, 'next');
				        break;
				      case curSlide + 2:
				        updateSlideClass(i, 'far-next');
				        break;
				      default:
				        updateSlideClass(i);
				        break;							
						}
					}
				},

				updateSlideClass_ = function(slideNum, className) {
					var slide = this.getSlide(slideNum);

					if (!slide) {
						return;
					}

					if (className) {
						slide.classList.add(className);
					}

					for (var i = 0, slideClass; slideClass = SLIDE_CLASSES_[i]; ++i) {
						if (className != slideClass) {
							slide.classList.remove(slideClass);
						}
					}
				};

			Polymer('impress-deck', {
				curSlide: 0,
				controlsActive: false,

				toggleKeyControls: function(e) {
					e.stopPropagation();
					this.controlsActive = this.controlsActive ? false : true;
				},

				// TODO:
				// Add slide fragment support
				// Add overview support
				// Add code highlighting
				// Toggle speaker notes
				nextSlide: function() {
					if (this.curSlide < this.totalSlides - 1) {
						var that = this;
						prevSlide_ = this.curSlide++;
						this.getSlide(prevSlide_).animateOut();
						window.setTimeout(function() {
							updateSlides_.bind(that)();
						}, 500);
						this.getSlide(this.curSlide).animateIn();
					}
				},

				// TODO:
				// Add slide fragment support
				// Add overview support
				// Add code highlighting
				// Toggle speaker notes
				prevSlide: function() {
					if (this.curSlide > 0) {
						var that = this;
						prevSlide_ = this.curSlide--;
						this.getSlide(prevSlide_).animateOut()
						window.setTimeout(function() {
							updateSlides_.bind(that)();
						}, 500);
						this.getSlide(this.curSlide).animateIn();
					}
				},

				getSlide: function(slideNum) {
					if ((slideNum < 0) || (slideNum >= this.totalSlides)) {
						return null;
					} else {
						return this.slides[slideNum];
					}
				},

				/* TODO
				 * 1) use Modernizr to allow for smartphones
				 * 2?) load config
				 * 3) 
				 */
				ready: function() {
					this.slides = this.$.slides.getDistributedNodes();
					this.totalSlides = this.slides.length;

					addEventListeners_.bind(this)();
					updateSlides_.bind(this)();
				}
			});
		})()
	</script>
</polymer-element>